@* @model StudentProjectManagement.Areas.Admin.Models.Task; *@
@using Newtonsoft.Json.Linq;
@model StudentProjectManagement.Areas.Admin.Models.StudentDetails; 
@inject Microsoft.AspNetCore.Http.IHttpContextAccessor HttpContextAccessor


<div class="content"> 
    @if (TempData["Message"] != null)
    {
        <div class="alert alert-success alert-icon m-4 d-flex justify-content-between" role="alert">
            <div>
                <i class="mdi mdi-checkbox-marked-outline"></i> @Html.Raw(TempData["Message"])
            </div>
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                <span aria-hidden="true">×</span>
            </button>
        </div>
    }
    @if (TempData["Error"] != null)
    {
        <div class="alert alert-danger alert-icon m-4 d-flex justify-content-between" role="alert">
            <div>
                <i class="mdi mdi-alert"></i>@Html.Raw(TempData["Error"])
            </div>
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                <span aria-hidden="true">×</span>
            </button>
        </div>
    }
    @if (ViewBag.Project == null)
    {
        <h2>Project Details Not Found</h2>
    }
    else
    {
        <div class="card w-100 p-3">
            <h3 class="mb-2">@ViewBag.Project["title"]</h3>
            <p>@ViewBag.Project["description"]</p>
            <div class="row g-5">
                <div class="form-control col m-2">
                    Start Date : @ViewBag.Project["startDate"]
                </div>
                <div class="form-control col m-2">
                    Start Date : @ViewBag.Project["endDate"]
                </div>
                <div class="form-control col m-2">
                    Mentor : @ViewBag.Project["mentor"]["user"]["firstName"] @ViewBag.Project["mentor"]["user"]["lastName"]
                </div>
                <div class="form-control col m-2">
                    Status : &nbsp;&nbsp;
                    @if (@ViewBag.Project["status"] == "Completed")
                    {
                        <span> <span class="badge badge-success">Completed</span></span>
                    }
                    else if (@ViewBag.Project["status"] == "Active")
                    {
                        <span><span class="badge badge-primary">Active</span></span>
                    }
                    else
                    {
                        <span><span class="badge badge-warning">Pending</span></span>
                    }
                </div>

            </div>
            <div class="mt-4">
                <h5 class="mb-2">Team Members</h5>
                @if (@ViewBag.Project["teamMembers"] != null && @ViewBag.Project["teamMembers"].Count > 0)
                {
                    <table width="100%" class="table table-product">
                        <thead>
                            <tr>
                                <th class="">Enrollment</th>
                                <th class="">Name</th>
                                <th class="">Email</th>
                                <th class=""></th>
                            </tr>
                        </thead>
                        <tbody>
                        @foreach (var member in @ViewBag.Project["teamMembers"])
                        {
                            <tr>
                                <td class=" ">@member["enrollmentNo"]</td>
                                <td class="">@member["name"]</td>
                                <td class="">@member["email"]</td>
                                <td class="" style="width: min-content">
                                    @* <span class="badge badge-danger" type="button" data-toggle="modal" data-target="#@member["teamMemberId"]" title="Remove Student"><span style="font-size:15px;" class="mdi mdi-delete"></span></span> *@
                                    <a asp-controller="Student" asp-action="StudentProfile" asp-route-studentId=@member["studentId"]><span class="badge badge-success" type="button"><span style="font-size:15px;" class="mdi mdi-eye" title="View Student Profile"></span></span></a>


                                    <div class="modal fade" id=@member["teamMemberId"] tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
                                         aria-hidden="true">
                                        <div class="modal-dialog" role="document">

                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <h5 class="modal-title" id="exampleModalLabel"></h5>
                                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                        <span aria-hidden="true">×</span>
                                                    </button>
                                                </div>
                                                <div class="modal-body">
                                                    Are You Sure You Want To Remove Student From Project 
                                                </div>
                                                <div class="modal-footer">
                                                    <button type="button" class="btn btn-danger btn-pill" data-dismiss="modal">No</button>
                                                    <a type="button" class="btn btn-primary btn-pill">Yes</a>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        }
                        </tbody>
                    </table>
                }
                else
                {
                    <p class="text-center">No teamMembers Available.</p>
                }
            </div>
            <div class="mt-4">
                <div class="d-flex justify-content-between">
                    <h5 class="mb-2">Project Evaluations</h5>
                    <h5 role="button" data-toggle="modal" data-target="#addEvalutionModel">
                        <span class="badge badge-primary badge-pill">Add Evaluation</span>
                    </h5>

                    <!-- Modal for Adding Evaluation -->
                    <div class="modal fade" id="addEvalutionModel" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                        <div class="modal-dialog" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="exampleModalLabel">Add Evaluation</h5>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">×</span>
                                    </button>
                                </div>

                                <div class="modal-body">
                                    <!-- Evaluation Form Inside Modal -->
                                      <form asp-action="SaveProjectEvalution" method="post" >
                                        <input id="EvaluationId" type="hidden" asp-for="evaluation.EvaluationId" />
                                        <input id="ProjectId" type="hidden" asp-for="evaluation.ProjectId" value=@ViewBag.Project["projectId"] />
                                        


                                        <div class="form-group">
                                            <label class="form-label">Evaluator<span class="text-danger">*</span></label>
                                            <select id="FacultyId" asp-for="evaluation.FacultyId" class="form-control">
                                                <option value="">Select Evaluator</option>
                                            </select>
                                            <span asp-validation-for="evaluation.FacultyId" class="text-danger"></span>
                                        </div>


                                        <div class="form-group">
                                            <label asp-for="evaluation.Score" class="form-label">Score<span class="text-danger">*</span></label>
                                            <input id="Score" asp-for="evaluation.Score" type="number" step="0.1" class="form-control" placeholder="Score" />
                                            <span asp-validation-for="evaluation.Score" class="text-danger"></span>
                                        </div>

                                        <div class="form-group">
                                            <label asp-for="evaluation.Feedback" class="form-label">Feedback<span class="text-danger">*</span></label>
                                            <textarea id="Feedback" asp-for="evaluation.Feedback" class="form-control" rows="3" placeholder="Enter feedback"></textarea>
                                            <span asp-validation-for="evaluation.Feedback" class="text-danger"></span>
                                        </div>

                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-secondary btn-1" data-dismiss="modal">Cancel</button>
                                            <button type="submit" class="btn btn-primary btn-1">Submit</button>
                                        </div>
                                    </form> 
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                @if (@ViewBag.Project["projectEvalutions"] != null && @ViewBag.Project["projectEvalutions"].Count > 0)
                {
                    <table width="100%" class="table table-product">
                        <tr>
                            <th class="">evaluatedBy</th>
                            <th class="">feedback</th>
                            <th class="">Date</th>
                            <th class="">score</th>
                            <th class=""></th>
                        </tr>
                        @foreach (var pe in ViewBag.Project["projectEvalutions"])
                        {
                            <tr>
                                <td class="">@pe["evaluatedBy"]</td>
                                <td class="">@pe["feedback"]</td>
                                <td class="">25/01/25</td>
                                <td class="">@pe["score"]%</td>
                                <td class="text-center" style="min-width: 150px;">
                                    <a class="edit-evaluation" data-id="@pe["evaluationId"]" data-toggle="modal" data-target="#addEvalutionModel">
                                        <span class="badge badge-warning" type="button">
                                        <span style="font-size:15px;" class="mdi mdi-pencil"></span></span>
                                    </a>
                                    <span class="badge badge-danger" type="button" data-toggle="modal" data-target="#demo"><span style="font-size:15px;" class="mdi mdi-delete"></span></span>
                                    <div class="modal fade" id="demo" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
                                         aria-hidden="true">
                                        <div class="modal-dialog" role="document">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <h5 class="modal-title" id="exampleModalLabel"></h5>
                                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                        <span aria-hidden="true">×</span>
                                                    </button>
                                                </div>
                                                <div class="modal-body">
                                                    Are You Sure You Want To Delete Project Evaluation @pe["evaluationId"]
                                                </div>
                                                <div class="modal-footer">
                                                    <button type="button" class="btn btn-danger btn-pill" data-dismiss="modal">No</button>
                                                    <a asp-action="ProjectEvaluationDelete" asp-route-ProjectEvaluationId="@pe["evaluationId"]" asp-route-projectId="@ViewBag.Project["projectId"]" type="button" class="btn btn-primary btn-pill">Yes</a>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </td> 
                            </tr>
                        }
                    </table>
                }
                else
                {
                    <p class="text-center">No Project Evalutions Available.</p>
                }
            </div>
            <div class="mt-4">

                <div class="d-flex justify-content-between">
                    <h5 class="mb-2">Tasks</h5>
                    <h5 role="button" data-toggle="modal" data-target="#addTask">
                         <span class="badge badge-primary badge-pill">Add Task</span> 
                    </h5>
                    <div class="modal fade" id="addTask" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                        <div class="modal-dialog" role="document">
                            <div class="modal-content" style="min-width: 600px;">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="exampleModalLabel">Add Task</h5>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">×</span>
                                    </button>
                                </div>

                                <div class="modal-body">

                                    <form id="taskForm" asp-action="SaveTask" method="post">
                                        <input type="hidden" id="TaskId" asp-for="task.TaskId" id="TaskId">
                                        <input type="hidden" id="createdBy" asp-for="task.CreatedBy" id="createdBy">
                                        <input type="hidden" id="ProjectId" asp-for="task.ProjectId" id="ProjectId" value="@ViewBag.Project["projectId"]">

                                        <div class="form-group">
                                            <label asp-for="task.Title"></label>
                                            <input asp-for="task.Title" id="Title" class="form-control" id="Title">
                                            <span class="text-danger" asp-validation-for="task.Title"></span>
                                        </div>

                                        <div class="form-group">
                                            <label asp-for="task.Description"></label>
                                            <textarea asp-for="task.Description" class="form-control" id="Description"></textarea>
                                            <span class="text-danger" asp-validation-for="task.Description"></span>
                                        </div>

                                        <div class="form-group row">
                                            <div class="col-md-6 mb-3">
                                                <label asp-for="task.Priority"></label>
                                                <select asp-for="task.Priority" id="Priority" class="form-control" id="Priority">
                                                    <option value="High">High</option>
                                                    <option value="Medium" selected>Medium</option>
                                                    <option value="Low">Low</option>
                                                </select>
                                                <span class="text-danger" asp-validation-for="task.Priority"></span>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label asp-for="task.Status"></label>
                                                <select asp-for="task.Status" id="Status" class="form-control" id="Status">
                                                    <option value="Pending" selected>Pending</option>
                                                    <option value="In Progress">In Progress</option>
                                                    <option value="Completed">Completed</option>
                                                </select>
                                                <span class="text-danger" asp-validation-for="task.Status"></span>
                                            </div>
                                        </div>

                                        <div class="form-group row">
                                            <div class="col-md-6 mb-3">
                                                <label asp-for="task.AssignedTo"></label>
                                                <select asp-for="task.AssignedTo" id="AssignedTo" class="form-control" id="AssignedTo">
                                                    <option value="">Select Member</option>
                                                </select>
                                                <span class="text-danger" asp-validation-for="task.AssignedTo"></span>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label asp-for="task.Deadline"></label>
                                                <input asp-for="task.Deadline" id="Deadline" type="date" class="form-control" id="Deadline">
                                                <span class="text-danger" asp-validation-for="task.Deadline"></span>
                                            </div>
                                        </div>

                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-secondary btn-1" data-dismiss="modal">Cancel</button>
                                            <button type="submit" class="btn btn-primary btn-1">Submit</button>
                                        </div>
                                    </form> 

                                    
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                @if (ViewBag.Project["taskDoneByMembers"] != null && ViewBag.Project["taskDoneByMembers"].Count > 0)
                {
                    @if (true)
                    {
                        <table id="studentTable" class="table table-product" style="width:100%">
                            <thead>
                                <tr>
                                    <th>Title</th>
                                    <th>deadline</th>
                                    <th>created By</th>
                                    <th>Priority</th>
                                    <th>Status</th>
                                    <th>Assign To</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var task in ViewBag.Project["taskDoneByMembers"])
                                {
                                    <tr>
                                        <td>@task["title"]</td>
                                        <td>@task["deadline"]</td>
                                        <td>@task["createdByNavigation"]["firstName"] @task["createdByNavigation"]["lastName"]</td>
                                        <td>
                                            @if (@task["priority"] == "High")
                                            {
                                                <span class="badge badge-danger">High</span>
                                            }
                                            else if (@task["priority"] == "Medium")
                                            {
                                                <span class="badge badge-info">Medium</span>
                                            }
                                            else
                                            {
                                                <span class="badge badge-light">Low</span>
                                            }
                                        </td>
                                        <td>
                                            @if (@task["status"] == "Completed")
                                            {
                                                <span class="badge badge-success">Completed</span>
                                            }
                                            else if (@task["status"] == "In Progress")
                                            {
                                                <span class="badge badge-primary">In Progress</span>
                                            }
                                            else
                                            {
                                                <span class="badge badge-warning">Pending</span>
                                            }

                                        </td>
                                        <td>@task["assignedToNavigation"]["user"]["firstName"] @task["assignedToNavigation"]["user"]["firstName"]</td>
                                        <td>
                                            <a class="edit-task" data-id="@task["taskId"]" data-toggle="modal" data-target="#addTask">
                                                <span class="badge badge-warning" type="button">
                                                    <span style="font-size:15px;" class="mdi mdi-pencil"></span>
                                                </span>
                                            </a>
                                            <span class="badge badge-danger" type="button" data-toggle="modal" data-target="#demo"><span style="font-size:15px;" class="mdi mdi-delete"></span></span>
                                            <div class="modal fade" id="demo" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
                                                 aria-hidden="true">
                                                <div class="modal-dialog" role="document">
                                                    <div class="modal-content">
                                                        <div class="modal-header">
                                                            <h5 class="modal-title" id="exampleModalLabel"></h5>
                                                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                                <span aria-hidden="true">×</span>
                                                            </button>
                                                        </div>
                                                        <div class="modal-body">
                                                            Are You Sure You Want To Delete Task 
                                                        </div>
                                                        <div class="modal-footer">
                                                            <button type="button" class="btn btn-danger btn-pill" data-dismiss="modal">No</button>
                                                            <a asp-action="TaskDelete" asp-route-taskId="@task["taskId"]" asp-route-projectId="@ViewBag.Project["projectId"]" type="button" class="btn btn-primary btn-pill">Yes</a>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    }

                }
                else
                {
                    <p class="text-center">No Tasks Done by Students</p>
                }
            </div>
            <div class="mt-4">
                
                <div class="d-flex justify-content-between">
                    <h5 class="mb-2">Team Members Evalutions</h5>
                    <h5 role="button" data-toggle="modal" data-target="#addMembersEvalutionModel">
                        <span class="badge badge-primary badge-pill">Add Members Evaluation</span>
                    </h5>

                    <!-- Modal for Adding Evaluation -->
                    <div class="modal fade" id="addMembersEvalutionModel" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                        <div class="modal-dialog" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="exampleModalLabel">Add Members Evaluation</h5>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">×</span>
                                    </button>
                                </div>

                                <div class="modal-body">
                                    <!-- Evaluation Form Inside Modal -->
                                    <form asp-action="SaveStudentEvaluation" method="post">
                                        <input id="StudentEvaluationsId" id="ProjectId" type="hidden" asp-for="studentEvaluation.StudentEvaluationsId" />
                                        <input id="ProjectId" type="hidden" id="ProjectId" asp-for="studentEvaluation.ProjectId" value="@ViewBag.Project["projectId"]" />

                                        <div class="form-group">
                                            <label asp-for="studentEvaluation.FacultyId" class="control-label">Evaluator</label>
                                            <select id="SEFacultyId" asp-for="studentEvaluation.FacultyId" class="form-control">
                                                <option value="">Select Evaluator</option>
                                            </select>
                                            <span asp-validation-for="studentEvaluation.FacultyId" class="text-danger"></span>
                                        </div>

                                        <div class="form-group">
                                            <label asp-for="studentEvaluation.StudentId" class="control-label">Student</label>
                                            <select id="SEStudentId" asp-for="studentEvaluation.StudentId" class="form-control">
                                                <option value="">Select student</option>
                                            </select>
                                            <span asp-validation-for="studentEvaluation.StudentId" class="text-danger"></span>
                                        </div>

                                        <div class="form-group">
                                            <label asp-for="studentEvaluation.Score" class="control-label"></label>
                                            <input id="studentEvaluation_Score" asp-for="studentEvaluation.Score" class="form-control" type="number" step="1" />
                                            <span asp-validation-for="studentEvaluation.Score" class="text-danger"></span>
                                        </div>

                                        <div class="form-group">
                                            <label asp-for="studentEvaluation.Feedback" class="control-label"></label>
                                            <textarea id="studentEvaluation_Feedback" asp-for="studentEvaluation.Feedback" class="form-control"></textarea>
                                            <span asp-validation-for="studentEvaluation.Feedback" class="text-danger"></span>
                                        </div>

                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-secondary btn-1" data-dismiss="modal">Cancel</button>
                                            <button type="submit" class="btn btn-primary btn-1">Submit</button>
                                        </div>
                                    </form>


                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                @if (ViewBag.Project["teamMembersEvalutions"] != null && ViewBag.Project["teamMembersEvalutions"].Count > 0)
                {
                    <div class="accordion" id="accordionTwo">
                        @foreach (var member in ViewBag.Project["teamMembersEvalutions"])
                        {
                            <div class="card">
                                <div class="card-header" id="headingBorderOne">
                                    <h2 class="mb-0">
                                        <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#tme-@member["studentId"]"
                                                aria-expanded="true" aria-controls="collapseBorderOne">
                                            @member["enrollmentNo"] - @member["memberName"]
                                        </button>
                                    </h2>
                                </div>
                                <div id=tme-@member["studentId"] class="collapse" aria-labelledby="headingBorderOne" data-parent="#accordionTwo">
                                    <div class="card-body p-1">
                                        <table width="100%">
                                            <tr>
                                                <th class="border p-1 text-center">evaluatedBy</th>
                                                <th class="border p-1 text-center">feedback</th>
                                                <th class="border p-1 text-center">Date</th>
                                                <th class="border p-1 text-center">score</th>
                                                @* <th class="border p-1 text-center"></th> *@
                                            </tr>
                                            @foreach (var evaluation in member["evaluation"])
                                            {
                                                <tr>
                                                    <td class="border p-1 ">@evaluation["evaluatedBy"]</td>
                                                    <td class="border p-1">@evaluation["feedback"]</td>
                                                    <td class="border p-1">25/01/25</td>
                                                    <td class="border p-1 text-center">@evaluation["score"]%</td>
                                                    <td class="text-center border p-1" style="min-width: 150px;">
                                                        <a class="edit-student-evaluation" data-evaluation-id="@evaluation["studentEvaluationsId"]">
                                                            <span class="badge badge-warning" type="button">
                                                                <span style="font-size:15px;" class="mdi mdi-pencil"></span>
                                                            </span>
                                                        </a>
                                                        <span class="badge badge-danger" type="button" data-toggle="modal" data-target="#deletestudentevaluation"><span style="font-size:15px;" class="mdi mdi-delete"></span></span>
                                                        <div class="modal fade" id="deletestudentevaluation" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
                                                             aria-hidden="true">
                                                            <div class="modal-dialog" role="document">
                                                                <div class="modal-content">
                                                                    <div class="modal-header">
                                                                        <h5 class="modal-title" id="exampleModalLabel"></h5>
                                                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                                            <span aria-hidden="true">×</span>
                                                                        </button>
                                                                    </div>
                                                                    <div class="modal-body">
                                                                        Are You Sure You Want To Delete Student Evaluation
                                                                    </div>
                                                                    <div class="modal-footer">
                                                                        <button type="button" class="btn btn-danger btn-pill" data-dismiss="modal">No</button>
                                                                        <a asp-action="StudentEvaluationDelete" asp-route-StudentEvaluationId="@evaluation["studentEvaluationsId"]" asp-route-projectId="@ViewBag.Project["projectId"]" type="button" class="btn btn-primary btn-pill">Yes</a>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </td>
                                                </tr>
                                            }
                                        </table>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                }
                else
                {
                    <p class="text-center">No Team Members Evalutions Available</p>
                }
            </div>
            <div class="mt-4">
                <h5 class="mb-2">Mentor Details</h5>
                <table class="w-50">
                    <tr>
                        <th class="border border-1 p-1 text-center">Mentor Name</th>
                        <td class="border border-1 p-1">@ViewBag.Project["mentor"]["user"]["firstName"] @ViewBag.Project["mentor"]["user"]["lastName"]</td>
                    </tr>
                    <tr>
                        <th class="border border-1 p-1 text-center">Email</th>
                        <td class="border border-1 p-1">@ViewBag.Project["mentor"]["user"]["email"]</td>
                    </tr>
                    <tr>
                        <th class="border border-1 p-1 text-center">Department</th>
                        <td class="border border-1 p-1">@ViewBag.Project["mentor"]["user"]["department"]</td>
                    </tr>
                    <tr>
                        <th class="border border-1 p-1 text-center">designation</th>
                        <td class="border border-1 p-1">@ViewBag.Project["mentor"]["designation"]</td>
                    </tr>
                </table>
            </div>
        </div>
    }
</div>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    var token = "@HttpContextAccessor.HttpContext.Session.GetString("Token")";
    $(document).ready(function () {
        $.ajax({
            url: "http://localhost:5223/api/Faculty", // API URL
            type: "GET",
            dataType: "json",
            headers: {
                "Authorization": "Bearer " + token
            },
            success: function (data) {
                var dropdown = $("#FacultyId"); // Target dropdown
                dropdown.empty(); // Clear existing options
                dropdown.append('<option value="">Select Evaluator</option>'); // Default option

                // Loop through API response and add options
                $.each(data, function (index, faculty) {
                    console.log(faculty.facultyId)
                    var fullName = faculty.user.firstName + " " + faculty.user.lastName;
                    dropdown.append('<option value="' + faculty.facultyId + '">' + fullName + ' (' + faculty.designation + ')</option>');
                });
            },
            error: function (xhr, status, error) {
                console.error("Error fetching data:", error);
            }
        });
    });

    $(document).ready(function () {
        $(".edit-evaluation").click(function () {
            var evaluationId = $(this).data("id"); // Get EvaluationId from button
            var apiUrl = "http://localhost:5223/api/Evaluation/" + evaluationId;
            console.log("::::::::::: "+apiUrl)
                
            $.ajax({
                url: apiUrl,
                type: "GET",
                dataType: "json",
                headers: {
                    "Authorization": "Bearer " + token
                },
                success: function (data) {
                    // Fill the form with fetched data
                    $("#EvaluationId").val(data.evaluationId);
                    $("#ProjectId").val(data.projectId);
                    $("#FacultyId").val(data.facultyId);
                    $("#Feedback").val(data.feedback);
                    $("#Score").val(data.score);

                    // Open the form (assuming it's in a modal)
                    $("#evaluationModal").modal("show");
                },
                error: function (err) {
                    console.log(err)
                    alert("Failed to load evaluation data.");
                }
            });
        });
    });

    $(document).ready(function () {
        $.ajax({
            url: "http://localhost:5223/api/Project/ProjectMembers/" + @ViewBag.Project["projectId"],
            type: "GET",
            dataType: "json",
            headers: {
                "Authorization": "Bearer " + token
            },
            success: function (data) {
                let dropdown = $("#AssignedTo");
                dropdown.empty().append('<option value="">Select Member</option>');

                console.log(data)
                $.each(data, function (index, member) {
                    let fullName = member.student.user.firstName + " " + member.student.user.lastName;
                    let studentId = member.student.studentId;
                    dropdown.append(`<option value="${studentId}">${fullName}</option>`);
                });
            },
            error: function (xhr, status, error) {
                console.error("Error fetching data:", error);
            }
        });
    });

    $(document).ready(function () {
        $(".edit-task").click(function () {
            var taskId = $(this).data("id");
            var apiUrl = `http://localhost:5223/api/Task/${taskId}`;

            $.ajax({
                url: apiUrl,
                type: "GET",
                headers: {
                    "Authorization": "Bearer " + token
                },
                success: function (data) {

                    // Populate form fields
                    $("#TaskId").val(data.taskId);
                    $("#ProjectId").val(data.projectId);
                    $("#Title").val(data.title);
                    $("#Description").val(data.description);
                    $("#Priority").val(data.priority);
                    $("#Status").val(data.status);
                    $("#AssignedTo").val(data.assignedTo);
                    $("#Deadline").val(data.deadline);
                    $("#createdBy").val(data.createdBy);

                    // Open the modal
                    $("#addTask").modal("show");
                },
                error: function (xhr, status, error) {
                    console.error("Error fetching task:", error);
                }
            });
        });

        // Check selected value on change
        $("#FacultyId").change(function () {
            console.log("Selected FacultyId:", $(this).val());
        });

        // Check value before form submission
        $("form").submit(function () {
            console.log("Submitting FacultyId:", $("#FacultyId").val());
        });
    });

        $(document).ready(function () {
        let projectId = document.getElementById("ProjectId").value
            // Load students for the project
            $.ajax({
            url: `http://localhost:5223/api/Project/ProjectMembers/${projectId}`,
                type: "GET",
                dataType: "json",
                headers: {
                    "Authorization": "Bearer " + token
                },
                success: function (data) {
                let studentDropdown = $("#SEStudentId");
                    studentDropdown.empty().append('<option value="">Select Student</option>');
                    data.forEach(member => {
                        let student = member.student.user;
                        studentDropdown.append(`<option value="${member.studentId}">${student.firstName} ${student.lastName}</option>`);
                    });
                },
                error: function () {
                    alert("Failed to load students.");
                }
            });

            // Load evaluators (faculty)
            $.ajax({
                url: "http://localhost:5223/api/Faculty",
                type: "GET",
                dataType: "json",
            headers: {
                "Authorization": "Bearer " + token
            },
                success: function (data) {
                let facultyDropdown = $("#SEFacultyId");
                    facultyDropdown.empty().append('<option value="">Select Evaluator</option>');
                    data.forEach(faculty => {
                        let user = faculty.user;
                        facultyDropdown.append(`<option value="${faculty.facultyId}">${user.firstName} ${user.lastName} (${faculty.designation})</option>`);
                    });
                },
                error: function () {
                    alert("Failed to load evaluators.");
                }
            });
        });

    $(document).ready(function () {
        $(".edit-student-evaluation").click(function () {
            var evaluationId = $(this).data("evaluation-id"); // Get Student Evaluation ID

            // API URL with selected studentEvaluationId
            var apiUrl = `http://localhost:5223/api/StudentEvaluation/${evaluationId}`;

            // Fetch evaluation details using AJAX
            $.ajax({
                url: apiUrl,
                type: "GET",
                headers: {
                    "Authorization": "Bearer " + token
                },
                success: function (response) {
                    // Populate form fields
                    $("#StudentEvaluationsId").val(response.studentEvaluationsId);
                    $("#ProjectId").val(response.projectId);
                    $("#SEFacultyId").val(response.facultyId);
                    $("#SEStudentId").val(response.studentId);
                    $("#studentEvaluation_Score").val(response.score);
                    $("#studentEvaluation_Feedback").val(response.feedback);

                    // Open the modal
                    $("#addMembersEvalutionModel").modal("show");
                },
                error: function () {
                    alert("Failed to fetch evaluation details.");
                }
            });
        });
    });
</script>
